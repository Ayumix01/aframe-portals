{"version":3,"file":"aframe-portals.module.js","sources":["../src/lib/aframe-aabb-collider-component.min.js","../src/portal.js","../src/portal-renderer.js"],"sourcesContent":["!function(e){function t(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var s={};return t.m=e,t.c=s,t.p=\"\",t(0)}([function(e,t){function s(e,t){var s;for(e.length=0,s=0;s<t.length;s++)e[s]=t[s]}if(\"undefined\"==typeof AFRAME)throw new Error(\"Component attempted to register before AFRAME was available.\");var i={childList:!0,attributes:!0,subtree:!0};AFRAME.registerComponent(\"aabb-collider\",{schema:{collideNonVisible:{default:!1},debug:{default:!1},enabled:{default:!0},interval:{default:80},objects:{default:\"\"}},init:function(){this.centerDifferenceVec3=new THREE.Vector3,this.clearedIntersectedEls=[],this.closestIntersectedEl=null,this.boundingBox=new THREE.Box3,this.boxCenter=new THREE.Vector3,this.boxHelper=new THREE.BoxHelper,this.boxMax=new THREE.Vector3,this.boxMin=new THREE.Vector3,this.hitClosestClearEventDetail={},this.hitClosestEventDetail={},this.intersectedEls=[],this.objectEls=[],this.newIntersectedEls=[],this.prevCheckTime=void 0,this.previousIntersectedEls=[],this.setDirty=this.setDirty.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.hitStartEventDetail={intersectedEls:this.newIntersectedEls}},play:function(){this.observer.observe(this.el.sceneEl,i),this.el.sceneEl.addEventListener(\"object3dset\",this.setDirty),this.el.sceneEl.addEventListener(\"object3dremove\",this.setDirty)},remove:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener(\"object3dset\",this.setDirty),this.el.sceneEl.removeEventListener(\"object3dremove\",this.setDirty)},tick:function(e){var t,i,n,r,o=this.boundingBox,l=this.centerDifferenceVec3,h=this.clearedIntersectedEls,c=this.intersectedEls,a=this.el,b=this.newIntersectedEls,d=this.objectEls,E=this.prevCheckTime,x=this.previousIntersectedEls;if(this.data.enabled&&!(E&&e-E<this.data.interval)){for(this.prevCheckTime=e,this.dirty&&this.refreshObjects(),o.setFromObject(a.object3D),this.boxMin.copy(o.min),this.boxMax.copy(o.max),o.getCenter(this.boxCenter),this.data.debug&&(this.boxHelper.setFromObject(a.object3D),this.boxHelper.parent||a.sceneEl.object3D.add(this.boxHelper)),s(x,c),c.length=0,r=0;r<d.length;r++)d[r]!==this.el&&(this.data.collideNonVisible||d[r].getAttribute(\"visible\")?this.isIntersecting(d[r])&&c.push(d[r]):this.data.debug&&(t=d[r].object3D.boxHelper,t&&(a.sceneEl.object3D.remove(t),d[r].object3D.boxHelper=null)));for(b.length=0,r=0;r<c.length;r++)x.indexOf(c[r])===-1&&b.push(c[r]);for(h.length=0,r=0;r<x.length;r++)c.indexOf(x[r])===-1&&(x[r].hasAttribute(\"aabb-collider\")||x[r].emit(\"hitend\"),h.push(x[r]));for(r=0;r<b.length;r++)b[r]!==this.el&&(b[r].hasAttribute(\"aabb-collider\")||b[r].emit(\"hitstart\"));for(r=0;r<c.length;r++)c[r]!==this.el&&(l.copy(c[r].object3D.boundingBoxCenter).sub(this.boxCenter),(void 0===i||l.length()<i)&&(i=l.length(),n=c[r]));!c.length&&this.closestIntersectedEl?(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit(\"hitclosestclear\"),this.closestIntersectedEl=null,a.emit(\"hitclosestclear\",this.hitClosestClearEventDetail)):n!==this.closestIntersectedEl&&(this.closestIntersectedEl&&(this.hitClosestClearEventDetail.el=this.closestIntersectedEl,this.closestIntersectedEl.emit(\"hitclosestclear\",this.hitClosestClearEventDetail)),n&&(n.emit(\"hitclosest\"),this.closestIntersectedEl=n,this.hitClosestEventDetail.el=n,a.emit(\"hitclosest\",this.hitClosestEventDetail))),h.length&&a.emit(\"hitend\"),b.length&&a.emit(\"hitstart\",this.hitStartEventDetail)}},isIntersecting:function(){var e=new THREE.Box3;return function(t){var s,i;return e.setFromObject(t.object3D),this.data.debug&&(t.object3D.boxHelper||(t.object3D.boxHelper=new THREE.BoxHelper(t.object3D,new THREE.Color(Math.random(),Math.random(),Math.random())),t.sceneEl.object3D.add(t.object3D.boxHelper)),t.object3D.boxHelper.setFromObject(t.object3D)),s=e.min,i=e.max,t.object3D.boundingBoxCenter=t.object3D.boundingBoxCenter||new THREE.Vector3,e.getCenter(t.object3D.boundingBoxCenter),this.boxMin.x<=i.x&&this.boxMax.x>=s.x&&this.boxMin.y<=i.y&&this.boxMax.y>=s.y&&this.boxMin.z<=i.z&&this.boxMax.z>=s.z}}(),setDirty:function(){this.dirty=!0},refreshObjects:function(){var e=this.data;this.objectEls=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.dirty=!1}})}]);","import './lib/aframe-aabb-collider-component.min';\r\n\r\nAFRAME.registerComponent('portal', {\r\n  schema: {\r\n    destSelector: { default: '' }, //rename\r\n    width: { default: 2 },\r\n    height: { default: 3 },\r\n    maxRecursion: { default: 2 },\r\n  },\r\n\r\n  init: function () {\r\n    const el = this.el;\r\n    const sceneEl = el.sceneEl;\r\n    const data = this.data;\r\n\r\n    el.justTeleported = false;\r\n\r\n    //portal mesh\r\n    const geometry = new THREE.BoxBufferGeometry(data.width, data.height, 0.01);\r\n    const material = new THREE.MeshBasicMaterial({\r\n      colorWrite: false,\r\n    });\r\n    const mesh = new THREE.Mesh(geometry, material);\r\n    mesh.geometry.computeBoundingSphere();\r\n    mesh.frustumCulled = true;\r\n    mesh.matrixAutoUpdate = false;\r\n    mesh.renderOrder = 2;\r\n    mesh.visible = true;\r\n\r\n    el.object3D.add(mesh);\r\n\r\n    sceneEl.addEventListener('loaded', () => {\r\n      const cameraEl = sceneEl.camera.el;\r\n      if (cameraEl.id) {\r\n        el.setAttribute('aabb-collider', { objects: `#${cameraEl.id}` });\r\n      } else {\r\n        cameraEl.id = 'web-portal-cam-tag';\r\n        el.setAttribute('aabb-collider', { objects: `#${cameraEl.id}` });\r\n      }\r\n    });\r\n\r\n    sceneEl.addEventListener('portal-teleported', () => {\r\n      el.justTeleported = true;\r\n    });\r\n\r\n    el.addEventListener('hitstart', function () {\r\n      if (el.justTeleported === true) return;\r\n      //teleport the camera\r\n      sceneEl.emit('portal-teleported');\r\n\r\n      const camera = sceneEl.camera;\r\n      const cameraEl = camera.el;\r\n\r\n      const destPortal = document.querySelector(data.destSelector).object3D;\r\n\r\n      const srcRotation = el.object3D.rotation;\r\n      const dstRotation = destPortal.rotation;\r\n\r\n      const deltaRotation = new THREE.Euler(\r\n        srcRotation.x - dstRotation.x,\r\n        srcRotation.y - dstRotation.y,\r\n        srcRotation.z - dstRotation.z\r\n      );\r\n\r\n      if (cameraEl.components['look-controls']) {\r\n        cameraEl.components['look-controls'].yawObject.rotation.y += deltaRotation.y;\r\n      }\r\n\r\n      const deltaPosition = new THREE.Vector3();\r\n      deltaPosition.subVectors(\r\n        camera.getWorldPosition(new THREE.Vector3()),\r\n        el.object3D.getWorldPosition(new THREE.Vector3())\r\n      );\r\n\r\n      const destPosition = destPortal.position.clone().add(deltaPosition);\r\n\r\n      camera.el.object3D.position.x = destPosition.x;\r\n      camera.el.object3D.position.y = destPosition.y;\r\n      camera.el.object3D.position.z = destPosition.z;\r\n    });\r\n\r\n    if (!sceneEl.portals) {\r\n      //use sceneEl to store state\r\n      sceneEl.portals = [];\r\n      sceneEl.portalPairs = [];\r\n    }\r\n\r\n    //if there is not already a portal-renderer entity, create one\r\n    if (Array.from(sceneEl.children).reduce((acc, c) => acc || c.hasAttribute('portal-renderer'), false) === false) {\r\n      const entity = document.createElement('a-entity');\r\n      entity.setAttribute('portal-renderer', { maxRecursion: data.maxRecursion });\r\n      sceneEl.appendChild(entity);\r\n    }\r\n\r\n    const portals = sceneEl.portals;\r\n    const pairs = sceneEl.portalPairs;\r\n\r\n    portals.push(el.object3D);\r\n\r\n    const dest = document.querySelector(data.destSelector);\r\n    if (dest) {\r\n      let isInPairs = false;\r\n      pairs.forEach((pair) => {\r\n        pair.forEach((portal) => {\r\n          if (portal == el.object3D) {\r\n            isInPairs = true;\r\n          }\r\n        });\r\n      });\r\n\r\n      if (isInPairs == false) {\r\n        pairs.push([el.object3D, dest.object3D]);\r\n      }\r\n    }\r\n  },\r\n\r\n  tick: function () {\r\n    const el = this.el;\r\n    if (el.justTeleported === true)\r\n      setTimeout(() => {\r\n        el.justTeleported = false;\r\n      }, 100);\r\n  },\r\n\r\n  /*\r\n  renderSinglePortal: function () {\r\n    const sceneEl = this.el.sceneEl;\r\n    const scene = sceneEl.object3D;\r\n    const renderer = sceneEl.renderer;\r\n    const camera = sceneEl.camera;\r\n\r\n    renderer.autoClear = false;\r\n    camera.matrixAutoUpdate = false;\r\n\r\n    const gl = renderer.getContext();\r\n\r\n    const portal = this.el.object3D;\r\n    const destPortal = document.querySelector(this.data.destSelector).object3D;\r\n\r\n    const tmpScene = new THREE.Scene();\r\n    tmpScene.children = scene.children;\r\n\r\n    const portalScene = new THREE.Scene();\r\n    portalScene.children = portal.children;\r\n\r\n    const virtualCam = new THREE.PerspectiveCamera().copy(camera);\r\n    virtualCam.matrixWorld = computeViewMatrix(camera, portal, destPortal);\r\n    //projection matrix for Oblique View Frustum Depth Projection and Clipping\r\n    virtualCam.projectionMatrix = computeProjectionMatrix(\r\n      destPortal,\r\n      virtualCam.matrixWorld,\r\n      virtualCam.projectionMatrix\r\n    );\r\n\r\n    gl.enable(gl.STENCIL_TEST);\r\n    gl.stencilOp(gl.KEEP, gl.KEEP, gl.REPLACE);\r\n    gl.stencilFunc(gl.NOTEQUAL, 1, 0xff);\r\n    gl.stencilMask(0xff);\r\n\r\n    renderer.render(portalScene, camera);\r\n\r\n    gl.stencilFunc(gl.EQUAL, 1, 0xff);\r\n    gl.stencilMask(0x00);\r\n\r\n    renderer.clearDepth();\r\n    renderer.render(tmpScene, virtualCam);\r\n\r\n    gl.stencilMask(0xff);\r\n    gl.disable(gl.STENCIL_TEST);\r\n\r\n    camera.matrixAutoUpdate = true;\r\n  },\r\n  */\r\n});\r\n","AFRAME.registerComponent('portal-renderer', {\r\n  schema: {\r\n    maxRecursion: { default: 2 },\r\n  },\r\n\r\n  init: function () {},\r\n\r\n  tock: function () {\r\n    const camera = this.el.sceneEl.camera;\r\n    const renderer = this.el.sceneEl.renderer;\r\n\r\n    this.renderRecursivePortals(renderer, camera, 0);\r\n  },\r\n\r\n  renderRecursivePortals: function (renderer, camera, recursionLevel) {\r\n    const sceneEl = this.el.sceneEl;\r\n    const portals = sceneEl.portals;\r\n    const pairs = sceneEl.portalPairs;\r\n\r\n    const gl = renderer.getContext();\r\n\r\n    renderer.autoClear = false;\r\n    camera.matrixAutoUpdate = false;\r\n\r\n    pairs.forEach((pair) => {\r\n      pair.forEach((portal, i) => {\r\n        const destPortal = pair[1 - i];\r\n\r\n        const portalScene = new THREE.Scene();\r\n        portalScene.children = portal.children;\r\n\r\n        gl.colorMask(false, false, false, false);\r\n        gl.depthMask(false);\r\n        gl.disable(gl.DEPTH_TEST);\r\n        gl.enable(gl.STENCIL_TEST);\r\n        gl.stencilFunc(gl.NOTEQUAL, recursionLevel, 0xff);\r\n        gl.stencilOp(gl.INCR, gl.KEEP, gl.KEEP);\r\n        gl.stencilMask(0xff);\r\n\r\n        //render portal into stencil buffer\r\n        renderer.render(portalScene, camera);\r\n\r\n        const virtualCam = new THREE.PerspectiveCamera().copy(camera);\r\n        virtualCam.matrixWorld = computeViewMatrix(camera, portal, destPortal);\r\n        //projection matrix for Oblique View Frustum Depth Projection and Clipping\r\n        virtualCam.projectionMatrix = computeProjectionMatrix(\r\n          destPortal,\r\n          virtualCam.matrixWorld,\r\n          virtualCam.projectionMatrix\r\n        );\r\n\r\n        if (recursionLevel == this.data.maxRecursion) {\r\n          gl.colorMask(true, true, true, true);\r\n          gl.depthMask(true);\r\n          renderer.clear(false, true, false);\r\n          gl.enable(gl.DEPTH_TEST);\r\n          gl.enable(gl.STENCIL_TEST);\r\n          gl.stencilMask(0x00);\r\n          gl.stencilFunc(gl.EQUAL, recursionLevel + 1, 0xff);\r\n\r\n          const nonPortals = new THREE.Scene();\r\n          nonPortals.children = sceneEl.object3D.children.filter((obj) => !portals.includes(obj));\r\n\r\n          const tmpScene = new THREE.Scene();\r\n          tmpScene.children = sceneEl.object3D.children;\r\n\r\n          //render the rest of the scene, limited to the stencil buffer\r\n          renderer.render(tmpScene, virtualCam);\r\n        } else {\r\n          //recursion\r\n          this.renderRecursivePortals(renderer, virtualCam, recursionLevel + 1);\r\n        }\r\n\r\n        gl.colorMask(false, false, false, false);\r\n        gl.depthMask(false);\r\n        gl.enable(gl.STENCIL_TEST);\r\n        gl.stencilMask(0xff);\r\n        gl.stencilFunc(gl.NOTEQUAL, recursionLevel + 1, 0xff);\r\n        gl.stencilOp(gl.DECR, gl.KEEP, gl.KEEP);\r\n\r\n        //render portal into stencil buffer\r\n        renderer.render(portalScene, camera);\r\n      });\r\n    });\r\n\r\n    gl.disable(gl.STENCIL_TEST);\r\n    gl.stencilMask(0x00);\r\n    gl.colorMask(false, false, false, false);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.depthMask(true);\r\n    gl.depthFunc(gl.ALWAYS);\r\n    renderer.clear(false, true, false);\r\n\r\n    //render portals into depth buffer\r\n    portals.forEach((portal) => {\r\n      const portalScene = new THREE.Scene();\r\n      portalScene.children = portal.children;\r\n      renderer.render(portalScene, camera);\r\n    });\r\n\r\n    gl.depthFunc(gl.LESS);\r\n    gl.enable(gl.STENCIL_TEST);\r\n    gl.stencilMask(0x00);\r\n    gl.stencilFunc(gl.LEQUAL, recursionLevel, 0xff);\r\n    gl.colorMask(true, true, true, true);\r\n    gl.depthMask(true);\r\n\r\n    const nonPortals = new THREE.Scene();\r\n    //nonPortals.children = sceneEl.object3D.children.filter((obj) => !portals.includes(obj));\r\n    nonPortals.children = sceneEl.object3D.children;\r\n\r\n    const tmpScene = new THREE.Scene();\r\n    tmpScene.children = sceneEl.object3D.children;\r\n\r\n    //render the rest of the scene, only at recursionLevel\r\n    renderer.render(tmpScene, camera);\r\n\r\n    camera.matrixAutoUpdate = true;\r\n  },\r\n});\r\n\r\nfunction computeViewMatrix(camera, src, dst) {\r\n  const srcToCam = camera.matrixWorld.clone();\r\n  srcToCam.invert().multiply(src.matrixWorld);\r\n\r\n  const dstInverse = dst.matrixWorld.clone().invert();\r\n  const rotationYMatrix = new THREE.Matrix4().makeRotationY(Math.PI);\r\n  const srcToDst = new THREE.Matrix4().multiply(srcToCam).multiply(rotationYMatrix).multiply(dstInverse);\r\n\r\n  return srcToDst.invert();\r\n}\r\n\r\nfunction computeProjectionMatrix(dst, viewMat, projMat) {\r\n  const cameraInverseViewMat = viewMat.clone().invert();\r\n\r\n  const dstRotationMatrix = new THREE.Matrix4().extractRotation(dst.matrixWorld);\r\n\r\n  const normal = new THREE.Vector3().set(0, 0, 1).applyMatrix4(dstRotationMatrix);\r\n\r\n  const clipPlane = new THREE.Plane();\r\n  clipPlane.setFromNormalAndCoplanarPoint(normal, dst.getWorldPosition(new THREE.Vector3()));\r\n  clipPlane.applyMatrix4(cameraInverseViewMat);\r\n\r\n  const clipVector = new THREE.Vector4();\r\n  clipVector.set(clipPlane.normal.x, clipPlane.normal.y, clipPlane.normal.z, clipPlane.constant);\r\n\r\n  const projectionMatrix = projMat.clone();\r\n\r\n  const q = new THREE.Vector4();\r\n  q.x = (Math.sign(clipVector.x) + projectionMatrix.elements[8]) / projectionMatrix.elements[0];\r\n  q.y = (Math.sign(clipVector.y) + projectionMatrix.elements[9]) / projectionMatrix.elements[5];\r\n  q.z = -1.0;\r\n  q.w = (1.0 + projectionMatrix.elements[10]) / projMat.elements[14];\r\n\r\n  clipVector.multiplyScalar(2 / clipVector.dot(q));\r\n\r\n  projectionMatrix.elements[2] = clipVector.x;\r\n  projectionMatrix.elements[6] = clipVector.y;\r\n  projectionMatrix.elements[10] = clipVector.z + 1.0;\r\n  projectionMatrix.elements[14] = clipVector.w;\r\n\r\n  return projectionMatrix;\r\n}\r\n"],"names":["e","t","i","s","exports","n","id","loaded","call","m","c","p","AFRAME","Error","childList","attributes","subtree","registerComponent","schema","collideNonVisible","default","debug","enabled","interval","objects","init","this","centerDifferenceVec3","THREE","Vector3","clearedIntersectedEls","closestIntersectedEl","boundingBox","Box3","boxCenter","boxHelper","BoxHelper","boxMax","boxMin","hitClosestClearEventDetail","hitClosestEventDetail","intersectedEls","objectEls","newIntersectedEls","prevCheckTime","previousIntersectedEls","setDirty","bind","observer","MutationObserver","dirty","hitStartEventDetail","play","observe","el","sceneEl","addEventListener","remove","disconnect","removeEventListener","tick","r","o","l","h","a","b","d","E","x","data","refreshObjects","setFromObject","object3D","copy","min","max","getCenter","parent","add","length","getAttribute","isIntersecting","push","indexOf","hasAttribute","emit","boundingBoxCenter","sub","Color","Math","random","y","z","querySelectorAll","children","destSelector","width","height","maxRecursion","justTeleported","geometry","BoxBufferGeometry","material","MeshBasicMaterial","colorWrite","mesh","Mesh","computeBoundingSphere","frustumCulled","matrixAutoUpdate","renderOrder","visible","cameraEl","camera","setAttribute","destPortal","document","querySelector","srcRotation","rotation","dstRotation","deltaRotation","Euler","components","yawObject","deltaPosition","subVectors","getWorldPosition","destPosition","position","clone","portals","portalPairs","Array","from","reduce","acc","entity","createElement","appendChild","pairs","dest","isInPairs","forEach","pair","portal","setTimeout","tock","renderRecursivePortals","renderer","recursionLevel","gl","getContext","autoClear","portalScene","Scene","colorMask","depthMask","disable","DEPTH_TEST","enable","STENCIL_TEST","stencilFunc","NOTEQUAL","stencilOp","INCR","KEEP","stencilMask","render","virtualCam","PerspectiveCamera","matrixWorld","src","dst","srcToCam","invert","multiply","dstInverse","rotationYMatrix","Matrix4","makeRotationY","PI","computeViewMatrix","projectionMatrix","viewMat","projMat","cameraInverseViewMat","dstRotationMatrix","extractRotation","normal","set","applyMatrix4","clipPlane","Plane","setFromNormalAndCoplanarPoint","clipVector","Vector4","constant","q","sign","elements","w","multiplyScalar","dot","computeProjectionMatrix","_this","clear","EQUAL","filter","obj","includes","tmpScene","DECR","depthFunc","ALWAYS","LESS","LEQUAL"],"mappings":"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"}